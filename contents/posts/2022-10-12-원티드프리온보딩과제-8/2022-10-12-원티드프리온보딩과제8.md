---
title: 'ì›í‹°ë“œ í”„ë¦¬ì˜¨ë³´ë”© ê³¼ì œ-ë¦¬íŒ©í† ë§:todoBtn ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬,ì—ëŸ¬í•¸ë“¤ë§'
date    : 2022-10-12
slug: ì›í‹°ë“œ-í”„ë¦¬ì˜¨ë³´ë”©-ê³¼ì œ-8
tags: [ì›í‹°ë“œí”„ë¦¬ì˜¨ë³´ë”©]
series: ì›í‹°ë“œí”„ë¦¬ì˜¨ë³´ë”©

---

## ìµœì í™”ë¥¼ ìœ„í•œ todo Btn ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬

TodoItemì€ memoë¥¼ í†µí•´ ìµœì í™”ë¥¼ í•´ë‘ì—ˆê¸° ë•Œë¬¸ì— íˆ¬ë‘ ì•„ì´í…œì— í´ë¦­ì„ í•˜ë©´ ë‹¤ë¥¸ íˆ¬ë‘ì•„ì´í…œë“¤ì´ re-renderingë˜ëŠ” ê²ƒì€ ë§‰ì•˜ë‹¤.

í•˜ì§€ë§Œ ê°™ì€ TodoItem ë‚´ë¶€ì—ì„œ í´ë¦­ë˜ì§€ ì•Šì€ ë²„íŠ¼ë“¤ì´ ë‹¤ì‹œ re-renderingì´ ë˜ëŠ” ê²ƒì„ ë³´ê³ , TodoBtn ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬í•˜ê³  memoë¡œ ê°ì‹¸ì¤€ ë‹¤ìŒ,

ì „ë‹¬í•´ì£¼ëŠ” í•¨ìˆ˜ë“¤ì€ useCallbackì„ í†µí•´ ë¶ˆí•„ìš”í•œ re-renderingì„ ë§‰ì•˜ë‹¤.

```react
//TodoBtn.jsx

function TodoBtn({ name, clicked, onClick, text }) {
  return (
    <S.Btn name={name} clicked={clicked} onClick={onClick}>
      {text}
    </S.Btn>
  );
}

export default memo(TodoBtn);

//TodoItem.jsx

function TodoItem({
  todoItem: { isCompleted, id, todo },
  todoItem,
  onDelete,
  onUpdate,
}) {
	...

  const onClick = useCallback((e) => {
    const { name } = e.currentTarget;
    if (name === 'cancel') {
      inputRef.current.value = ``;
    }
    setOnModifyMode((prev) => !prev);
  }, []);

  const handleDelete = useCallback(() => {
    onDelete(id);
  }, [id, onDelete]);

  const handleCompleteUpdate = useCallback((e) => {
    const { name } = e.currentTarget;
    if (name === 'complete') {
      setUpdated((prev) => {
        return { ...prev, isCompleted: true };
      });
    } else {
      setUpdated((prev) => {
        return { ...prev, isCompleted: false };
      });
    }
  }, []);

  const handleSubmit = useCallback(() => {
    const todo = inputRef.current.value;
    if (!todo) {
      setIsBlank(true);
      return;
    }
    onUpdate({ ...updated, todo });
    inputRef.current.value = ``;
    setOnModifyMode((prev) => !prev);
    setIsBlank(false);
  }, [onUpdate, updated]);

  return (
    <S.TodoLayout>
     ...
      <S.RightBox>
        {onModifyMode ? (
          <>
            <div>
              <TodoBtn
                name='complete'
                clicked={updated.isCompleted}
                onClick={handleCompleteUpdate}
                text='CompletedğŸ™†â€â™€ï¸'
              ></TodoBtn>
              <TodoBtn
                name='not yet'
                clicked={!updated.isCompleted}
                onClick={handleCompleteUpdate}
                text='Not yet ğŸ™…â€â™‚ï¸'
              ></TodoBtn>
            </div>
            <TodoBtn name='cancel' onClick={onClick} text='ì·¨ì†Œí•˜ê¸°'></TodoBtn>
            <TodoBtn
              name='submit'
              onClick={handleSubmit}
              text='ì œì¶œí•˜ê¸°'
            ></TodoBtn>
          </>
        ) : (
          <>
            <TodoBtn
              text={isCompleted ? 'CompletedğŸ™†â€â™€ï¸' : 'Not yet ğŸ™…â€â™‚ï¸'}
            ></TodoBtn>
            <TodoBtn
              name='modify'
              onClick={onClick}
              text={'ìˆ˜ì •í•˜ê¸°'}
            ></TodoBtn>
          </>
        )}
        <TodoBtn onClick={handleDelete} text={'ì‚­ì œí•˜ê¸°'}></TodoBtn>
      </S.RightBox>
    </S.TodoLayout>
  );
}

export default memo(TodoItem);

```

## fetchë¥¼ ì´ìš©í•œ ì—ëŸ¬í•¸ë“¤ë§

#### ë¬¸ì œì 

â€‹ ê¸°ì¡´ ì½”ë“œì—ì„œ exceptionTestë¼ëŠ” í•¨ìˆ˜ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆë˜, ì„±ê³µì„ í–ˆë˜ dataë¥¼ ë°›ì•„ì„œ, ì„±ê³µê³¼ ì‹¤íŒ¨ë¥¼ í•¨ê»˜ ì²˜ë¦¬í–ˆë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ì²˜ë¦¬í•˜ê²Œ ë˜ë©´ ì„±ê³µê³¼ ì‹¤íŒ¨ê°€ ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì… ê°ê°ì— ë§ê²Œ ì—‰ì¼œìˆê³  ë„ˆë¬´ ë§ì€ ì¼ì„ í•˜ë‹¤ ë³´ë‹ˆ, ë°›ì•„ì•¼í•  ë³€ìˆ˜ê°€ ë§ì•„ ì´í•´í•˜ê¸° ì–´ë µê³  ìˆ˜ì •í•˜ê¸°ë„ ì–´ë ¤ì› ë‹¤.

```javascript
const exceptionTest = useCallback(
  (data, setMessage, process) => {
    let result = { message: '', success: false };
    if (data.statusCode >= 400) {
      if (data.statusCode === 401) {
        result = {
          message: 'ì´ë©”ì¼ í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.',
          success: false,
        };
      } else {
        result = {
          message: data.message,
          success: false,
        };
      }
    } else {
      if (process === 'login') {
        navigate('/todo');
        localStorage.setItem('access_token', data.access_token);
      }
      result = {
        message: `${
          process === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'
        }ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤`,
        success: true,
      };
    }

    setMessage((prev) => {
      return {
        ...prev,
        ...result,
      };
    });
  },
  [navigate]
);
```

#### í•´ê²°ë°©ë²•

ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì‹¶ì–´ì„œ ì—ëŸ¬í•¸ë“¤ë§ì— ëŒ€í•œ ìë£Œë¥¼ ê³„ì†í•´ì„œ ì°¾ê³  ìˆì—ˆì§€ë§Œ ì •í™•íˆ ì´í•´ê°€ ë˜ì§€ ì•Šì•„ì„œ ì •ë¦¬í•˜ì§€ ëª»í•˜ê³  ìˆì—ˆë‹¤ê°€, íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œ fetchë¥¼ ì´ìš©í•´ ì—ëŸ¬ í•¸ë“¤ë§ì„ í•˜ì‹  ê¸€ì„ ë³´ê²Œ ë˜ì—ˆë‹¤. ( https://www.rinae.dev/posts/how-to-handle-errors-2)

ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.

```typescript
class CustomError extends Error {
  name: string
  constructor(message?: string) {
    super(message)
    this.name = new.target.name
    Object.setPrototypeOf(this, new.target.prototype)
    Error.captureStackTrace && Error.captureStackTrace(this, this.constructor) // í•˜ëŠ” ê¹€ì— ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤ë„ ë°”ë¡œì¡ì•„ì¤ì‹œë‹¤
  }
}
class HTTPError extends CustomError {
  constructor(
    private statusCode: number,
    private errorData: Record<string, any>,
    message?: string
  ) {
    super(message)
    this.name = â€˜HTTPErrorâ€™
  }
  get rawErrorData() {
    return this.errorData
  }
  get codeToErrorMessage() {
    switch (this.statusCode) {
      case 401:
        return `You donâ€™t have a permission.`
      // ...
    }
  }
}

```

Error ê°ì²´ë¥¼ ìƒì†í•˜ëŠ” CustomError í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , CustomErrorí´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” HTTPErrorí´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ í•´ë‹¹ statusCodeì— ë”°ë¥¸ ê²°ê³¼ë¥¼ ì „ë‹¬í•´ì£¼ëŠ” ë°©ì‹ì´ì—ˆë‹¤.

HTTPErrorí´ë˜ìŠ¤ëŠ” getterë¥¼ ì´ìš©í•´ codeToErrorMessageë¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆëŠ”ë° getterë¥¼ ì´ìš©í•œ ì´ìœ ëŠ” í´ë˜ìŠ¤ì˜ statusCodeê°’ì´ ë°”ë€” ë•Œ ê°™ì´ ì—…ë°ì´íŠ¸ ë  ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•´ì„œë¼ê³  ìƒê°ë˜ì—ˆê³ , ì§ì ‘ì ì¸ ìˆ˜ì •ì„ ë§‰ê¸°ìœ„í•´ì„œ getterë¡œ ì½ì„ ìˆ˜ë§Œ ìˆê²Œ ì„¤ì •í–ˆë‹¤ê³  ì´í•´í–ˆë‹¤.

#### ì ìš©í•´ë³´ê¸°

ì´ ê¸€ì„ ì œëŒ€ë¡œ ì´í•´í•˜ê³  ì´ë ‡ê²Œ í•œë²ˆ í•´ë³´ê¸°ë¡œ ë§ˆìŒë¨¹ì—ˆì„ ë•Œ ì‹œê°„ì´ ì €ë… 11ì‹œì—¬ì„œ, 12ì‹œê°€ ë˜ê¸° ì „ ì œì¶œí•´ì•¼í–ˆê¸° ë•Œë¬¸ì— ìš°ì„  HTTPErrorí´ë˜ìŠ¤ë§Œ Errorë¥¼ ìƒì†í•´ ë§Œë“¤ì—ˆë‹¤.

Errorê°ì²´ë¥¼ ìƒì†í•  ë•ŒëŠ” ë°˜ë“œì‹œ messageë¥¼ ì „ë‹¬í•´ì£¼ì–´ì•¼í•˜ê¸°ì— superë¥¼ í†µí•´ ìƒì†í•œ Errorê°ì²´ì— ì „ë‹¬í•˜ê³ , statusCodeë¥¼ constructorí•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì €ì¥í•œë‹¤. constructorë¥¼ í†µí•´ ì €ì¥í•œ statusCodeì— ë”°ë¼ messageìƒíƒœì— ì „í•´ì¤„ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê²Œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤.

í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨ HTTPì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œì˜ ë¡œì§ì„ ë¶„ë¦¬í•´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë” ê°€ë…ì„±ì´ ì¢‹ì•„ì¡Œë‹¤.

```javascript
//auth.js

class HTTPError extends Error {
  constructor(statusCode, message) {
    super(message);
    this.name = `HTTPError`;
    this.statusCode = statusCode;
  }

  get codeToErrorMessage() {
    let result = { message: '', success: false };
    switch (this.statusCode) {
      case 400:
        result = {
          message: 'ë™ì¼í•œ ì´ë©”ì¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.',
          success: false,
        };
        break;
      case 401:
        result = {
          message: 'ì´ë©”ì¼ í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.',
          success: false,
        };
        break;
      case 404:
        result = {
          message: 'í•´ë‹¹ ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
          success: false,
        };
        break;
      default:
        throw new Error('Unknown Error');
    }
    return result;
  }
}

export async function postSignUp(email, password) {
  try {
    const res = await fetch(`${BASE_URL}/auth/signup`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        email,
        password,
      }),
    });
    if (!res.ok) {
      console.log(`${res.status}ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤`);
      throw new HTTPError(res.status, res.statusText);
    } else {
      return await res.json();
    }
  } catch (e) {
    return e.codeToErrorMessage;
  }
}
```

ë°˜í™˜í•œ ê°ì²´ë¥¼ ë°›ì•˜ë˜ handleSubmití•¨ìˆ˜ëŠ” ê°ê° loginê³¼ íšŒì›ê°€ì…ìœ¼ë¡œ 2ê°œì˜ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í–ˆë‹¤.

ë¶„ë¦¬ í›„ì— ì„±ê³µí•œ ê²½ìš°ëŠ” ë‘˜ ë‹¤ access_tokenì´ ë“¤ì–´ìˆëŠ” ê°ì²´ë¥¼ ì „ë‹¬ë°›ê¸° ë•Œë¬¸ì— access_tokenì´ë¼ëŠ” í”„ë¡œí¼í‹°ì˜ ìœ ë¬´ì— ë”°ë¼ ì„±ê³µê³¼ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•˜ê²Œ í–ˆë‹¤.

```react
//auth.jsx

const handleLoginSubmit = useCallback(
    (info) => {
      const { email, password } = info;
      postSignIn(email, password) //
        .then((data) => {
          if ('access_token' in data) {
            navigate('/todo');
            localStorage.setItem('access_token', data.access_token);
          } else {
            setLoginMessage((prev) => {
              return {
                ...prev,
                ...data,
              };
            });
          }
        });
    },
    [navigate]
  );

const handleRegisterSubmit = useCallback((info) => {
    const { email, password } = info;
    postSignUp(email, password) //
      .then((data) => {
        if ('access_token' in data) {
          data = {
            message: `íšŒì›ê°€ì…ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤`,
            success: true,
          };
        }
        setRegisterMessage((prev) => {
          return {
            ...prev,
            ...data,
          };
        });
      });
  }, []);
```

ì´ë ‡ê²Œ ì—ëŸ¬ì™€ ì„±ê³µ, ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì…ì„ ë¡œì§ì„ ë¶„ë¦¬í•˜ë‹ˆê¹Œ ë” ë³´ê¸° ì¢‹ê³  ì´í•´ê°€ í¸í•´ì¡Œë‹¤.

ë„ˆë¬´ ê³¼ë„í•˜ê²Œ í•©ì¹˜ëŠ” ê²Œ ë” ì´í•´í•˜ê¸° ì–´ë µë‹¤ëŠ” ê²ƒì„ ëŠê¼ˆê³ , ì—ëŸ¬í•¸ë“¤ë§ì„ í•  ë•Œ customErrorí´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë°°ìš¸ ìˆ˜ ìˆì—ˆë‹¤.
