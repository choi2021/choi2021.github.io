{"componentChunkName":"component---src-templates-post-jsx","path":"/2022-12-25-모으잡-서버사이드-랜더링을-이용한-성능개선/","result":{"data":{"site":{"siteMetadata":{"title":"Troy DevLog"}},"markdownRemark":{"id":"4d86f4ac-998a-59a5-a4e2-a474b8dbc7f7","excerpt":"🕶서버사이드 랜더링을 이용한 성능 개선 모으잡 프로젝트 기획과 디자인을 수정하고 나서 그다음 작업으로 성능 개선을 목표로 잡았다. 다른 기능을 추가하기 보다 Next 자체를 좀 더 잘 쓰는 방법에 대해 고민했고 그 방법으로 Next의 장점을 살리려 고민했다. Next의 장점은 이미지 최적화나 코드 스플릿팅 등을 자동으로 지원해 주는 장점도 있지만 가장 큰…","html":"<h1>🕶서버사이드 랜더링을 이용한 성능 개선</h1>\n<p>모으잡 프로젝트 기획과 디자인을 수정하고 나서 그다음 작업으로 성능 개선을 목표로 잡았다. 다른 기능을 추가하기 보다 Next 자체를 좀 더 잘 쓰는 방법에 대해 고민했고 그 방법으로 <strong>Next의 장점</strong>을 살리려 고민했다. Next의 장점은 이미지 최적화나 코드 스플릿팅 등을 자동으로 지원해 주는 장점도 있지만 가장 큰 장점은 react에서 <strong>서버 사이드 랜더링</strong> 가능하다는 점이다. 서버 사이드 랜더링은 기존 SPA에서는 구현하기 힘든 <u>SEO 문제</u>를 쉽게 해결할 수 있고, 먼저 페이지를 보여 줌으로써 <u>사용자 경험을 향상</u>시킬 수 있다. 서버 사이드 렌더링을 적용해 해결해나간 과정을 정리해보려 한다.</p>\n<h2>⛳ 모으잡 SEO 최적화</h2>\n<p><strong>SEO</strong> 는 Search Engine Optimization의 약자로 말 그대로 검색엔진 최적화를 의미한다. 검색엔진을 최적화 시킨다는 것은 구글이나 네이버와 같은 검색 사이트를 이용할 때 해당 키워드에 대해서 우선순위가 높게 나오게 만드는 것을 의미한다. 실제로 우리가 정보를 찾을 때 무조건 구글과 같은 검색 사이트를 통해 찾게 되는데 이러한 검색 사이트에서 높은 순위로 먼저 보인다는 것은 엄청난 마케팅 효과를 가진다.</p>\n<p>그렇기 때문에 SEO는 서비스의 중요한 부분이 되었기 때문에 SEO 최적화는 중요한 성능 지표 중 하나가 되었다. SEO 최적화를 위해 먼저 검색엔진이 동작하는 방식을 정리해보자</p>\n<ol>\n<li>크롤링: 웹 크롤러가 사이트를 방문해 컨텐츠를 복사해서 검색엔진으로 가져온다.</li>\n<li>인덱싱: 가져온 컨텐츠를 주제 별로 색인해서 보관한다.</li>\n<li>랭킹: 검색 요청에 따라 색인된 컨텐츠에 순위를 부여해서 결과로 제공한다.</li>\n</ol>\n<img src='https://lh6.googleusercontent.com/d_mF-4gS_inHDlP2GKpu87w0FzW8R4tfcThdwmNm8F730hHnCOoXwdgAFsdDu5fGJb-sgzZU2hj1JURZKty7uhmxdYNpJZQ-8Jo9N-1oV4NgDLIAZXAKXzV7tXB74OymG3KG2t5a' width='600'>\n<p>여기서 CSR이 SEO의 단점을 가지는 이유는 크롤링 과정에서 크롤러가 방문했을 때 비어있는 html문서만 복사하게 되기 때문이다. 이때 SSR을 통해 만들어진 페이지라면 먼저 컨텐츠가 있는 html을 크롤러가 복사해서 가져간다면 높은 순위로 보이게 된다.</p>\n<p>CSR로 무조건 SEO 최적화를 못하는 것은 아니다. <a href=\"https://choi2021.github.io/posts/%EC%9B%90%ED%8B%B0%EB%93%9C-%ED%94%84%EB%A6%AC%EC%98%A8%EB%B3%B4%EB%94%A9-2-1-%EA%B3%BC%EC%A0%9C-%ED%9A%8C%EA%B3%A0/\">원티드 프리온보딩 과제</a>로 SNS의 공유시 이미지와 설명을 담을 수 있는 기능이 필요해 CSR로 <code class=\"language-text\">react-helmet</code>과 <code class=\"language-text\">react-snap</code>을 이용해 구현을 했었다. 하지만 오랜 시간 걸렸고 <code class=\"language-text\">react-snap</code>은 2년이나 업데이트가 되고 있지 않는 라이브러리라는 문제점도 있었다.</p>\n<p>그렇기 때문에 이번에는 SSR를 이용해 모으잡 프로젝트에 SEO 최적화를 적용해보려 한다.</p>\n<h3>기존 상황</h3>\n<p>작업 전 상황은 일부 페이지에 간단한 title정보만 <code class=\"language-text\">&lt;Head/></code>태그 내에 작성되어 있는 상태였다. 개선하고 나서 비교를 위해 검색엔진 최적화 점수를 light house를 이용해 측정했을 때 아래와 같은 결과가 나타났다.</p>\n<p>[수정 전 light house 검색엔진 점수]</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/1909a09304fbfd270009b5f12127e609/1ed31/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%A0%90%EC%88%98.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 50.588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABKUlEQVR42p2R3VLEIAyF+/6P5J0PoDf7AI7VWXe2Wyh/BUrhmNBWO666o8x8E5JAOAkNbqxcMvrZ4TVKlFIqv63mpwRdrXbIHneXB9yLA1QOa+4fBZebBWPweByecNAtQgx/VzjPM1JKyDnDOouX9hmntxO68xlt28IYUx/ic98VvyrIF/q+hxCSrMCgNHohcKGYlJLignyJruvhRne74DRNsNbCEJ1KOMoMqT3FTMXYEWeVcRQJ1uermTbOOWhSZYytbTLcDrPf7/1qN77km6A1RlIzKAVNe0V2m+HCvNuvBSsJJSfyUz3PnXnv0URSOBI8O1bLcCLG+EEIobL50xThYoHygE+f7XKu4YM8r62gqe0v8CztmtvHHP3+YCd0OkGPpLIqTPXRd6O2DwIGQdEPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='검색엔진' title='' src='/static/1909a09304fbfd270009b5f12127e609/ca1dc/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%A0%90%EC%88%98.png' srcset='/static/1909a09304fbfd270009b5f12127e609/e7570/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%A0%90%EC%88%98.png 170w,\n/static/1909a09304fbfd270009b5f12127e609/f46e7/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%A0%90%EC%88%98.png 340w,\n/static/1909a09304fbfd270009b5f12127e609/ca1dc/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%A0%90%EC%88%98.png 680w,\n/static/1909a09304fbfd270009b5f12127e609/1ed31/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%A0%90%EC%88%98.png 974w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>검색엔진</figcaption>\n  </figure></p>\n<h3>Next-seo 적용과 OG 문제점</h3>\n<p>개선을 위해서 <code class=\"language-text\">head</code>내용을 더 간편하게 사용할 수 있는 <code class=\"language-text\">Next-SEO</code>라이브러리를 이용해 meta태그와 SNS공유를 위한 Open Graph 내용을 추가했다. <code class=\"language-text\">Next-seo</code>는 <code class=\"language-text\">DefaultSeo</code>라는 컴포넌트가 있어 공통되는 부분을 한 곳에서 정의할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// _app.tsx</span>\n<span class=\"token keyword\">const</span> defaultSEO <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  defaultTitle<span class=\"token operator\">:</span> <span class=\"token string\">'모으잡'</span><span class=\"token punctuation\">,</span>\n  titleTemplate<span class=\"token operator\">:</span> <span class=\"token string\">'%s | 모으잡'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// %s로 페이지마다 title을 전달해줄 수 있어</span>\n  description<span class=\"token operator\">:</span> <span class=\"token string\">'원하는 회사의 채용공고를 모으고 비교해보자'</span><span class=\"token punctuation\">,</span>\n  canonical<span class=\"token operator\">:</span> <span class=\"token string\">'https://moejob.vercel.app/'</span><span class=\"token punctuation\">,</span>\n  keywords<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'moejob'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'choi2021'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'모으잡'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  icon<span class=\"token operator\">:</span> <span class=\"token string\">'/favicon.ico'</span><span class=\"token punctuation\">,</span>\n  openGraph<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">'website'</span><span class=\"token punctuation\">,</span>\n    locale<span class=\"token operator\">:</span> <span class=\"token string\">'ko_KR'</span><span class=\"token punctuation\">,</span>\n    url<span class=\"token operator\">:</span> <span class=\"token string\">'https://moejob.vercel.app'</span><span class=\"token punctuation\">,</span>\n    title<span class=\"token operator\">:</span> <span class=\"token string\">'모으잡'</span><span class=\"token punctuation\">,</span>\n    site_name<span class=\"token operator\">:</span> <span class=\"token string\">'모으잡'</span><span class=\"token punctuation\">,</span>\n    description<span class=\"token operator\">:</span> <span class=\"token string\">'원하는 회사의 채용공고를 모으고 비교해보자'</span><span class=\"token punctuation\">,</span>\n    images<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        url<span class=\"token operator\">:</span> <span class=\"token string\">'/banner.jpg'</span><span class=\"token punctuation\">,</span>\n        width<span class=\"token operator\">:</span> <span class=\"token number\">285</span><span class=\"token punctuation\">,</span>\n        height<span class=\"token operator\">:</span> <span class=\"token number\">167</span><span class=\"token punctuation\">,</span>\n        alt<span class=\"token operator\">:</span> <span class=\"token string\">'이미지'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>queryClient<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> dbService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DBServiceImpl</span><span class=\"token punctuation\">(</span>firebaseApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DefaultSeo</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>defaultSEO<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      ...\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp<span class=\"token punctuation\">;</span></code></pre></div>\n<p>각 페이지마다 내용을 <code class=\"language-text\">NextSeo</code>컴포넌트의 props로 전달해 성능을 다시 검사했을 때 간단하게 SEO 최적화를 할 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// pages/login.tsx</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Login</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      &lt;NextSeo\n        title=\"로그인\"\n        description=\"원하는 회사의 채용공고를 모으고 비교해보자\"\n        openGraph=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">%</span> raw <span class=\"token operator\">%</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n          type<span class=\"token operator\">:</span> <span class=\"token string\">'website'</span><span class=\"token punctuation\">,</span>\n          url<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NEXT_PUBLIC_BASE_URL</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/login</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          title<span class=\"token operator\">:</span> <span class=\"token string\">'로그인 | 모으잡'</span><span class=\"token punctuation\">,</span>\n          description<span class=\"token operator\">:</span> <span class=\"token string\">'원하는 회사의 채용공고를 모으고 비교해보자'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span><span class=\"token operator\">%</span> endraw <span class=\"token operator\">%</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      />\n     ...\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// pages/jobs/[id]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      &lt;NextSeo\n        title=</span><span class=\"token punctuation\">{</span>job<span class=\"token operator\">?.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        openGraph=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">%</span> raw <span class=\"token operator\">%</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n          title<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token operator\">?.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          url<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NEXT_PUBLIC_BASE_URL</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/jobs/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token operator\">?.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          images<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n              url<span class=\"token operator\">:</span> job<span class=\"token operator\">?.</span>img <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n              width<span class=\"token operator\">:</span> <span class=\"token number\">285</span><span class=\"token punctuation\">,</span>\n              height<span class=\"token operator\">:</span> <span class=\"token number\">167</span><span class=\"token punctuation\">,</span>\n              alt<span class=\"token operator\">:</span> <span class=\"token string\">'상세 이미지'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span><span class=\"token operator\">%</span> endraw <span class=\"token operator\">%</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      />\n    \t...\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Index<span class=\"token punctuation\">;</span></code></pre></div>\n<p>[Next-seo를 적용하고 검색엔진 최적화 점수]\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/cc1f9bd2b46a14028c6f8092519382c3/9b76f/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%B5%9C%EC%A0%81%ED%99%94.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 59.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFklEQVR42qVS7U6EMBDs+7+Pf3wAExN9AuMfjtNTLFBIuX7B2OkJQQ4iF5dMt91lp9NtBXbYu1d4i9hjYisxxI+meoP74hl3pwd8Bf0rdxPhaCY4PKlXPKoXdMHernAYBoQQ0rzrOuSHHPnxiM+iwCHL0LZtyvV9n/7dJByTLKiqCnVdoywllIpelheUFzAnpYTW+m+FxphI2sQihY/KIpcestZoIrFSCqppcYrxrLCotb8mJAGPRnB+Pp9hrU2KqbkfqH7Zlp/4olWsExyWhJwn4ri21kzxyadNzVUPuRbe+8RMT/BC6J1zU2wEY3OsEnJXwjm/emt7jbXcRISZgjnhFnnq7UpufG6CfTLxyOwN39Z/FX4DaEiwd0UJ3aUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='검색엔진최적화' title='' src='/static/cc1f9bd2b46a14028c6f8092519382c3/ca1dc/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%B5%9C%EC%A0%81%ED%99%94.png' srcset='/static/cc1f9bd2b46a14028c6f8092519382c3/e7570/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%B5%9C%EC%A0%81%ED%99%94.png 170w,\n/static/cc1f9bd2b46a14028c6f8092519382c3/f46e7/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%B5%9C%EC%A0%81%ED%99%94.png 340w,\n/static/cc1f9bd2b46a14028c6f8092519382c3/ca1dc/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%B5%9C%EC%A0%81%ED%99%94.png 680w,\n/static/cc1f9bd2b46a14028c6f8092519382c3/9b76f/%EA%B2%80%EC%83%89%EC%97%94%EC%A7%84%EC%B5%9C%EC%A0%81%ED%99%94.png 978w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>검색엔진최적화</figcaption>\n  </figure></p>\n<p>하지만 SNS로 공유했을 때 상세 페이지에서도 <code class=\"language-text\">Default SEO</code>에 설정했던 이미지와 description이 공유되는 문제가 있었다. 카카오 톡, 페이스북, 슬랙 모두 기본 내용이 전달되는 것을 확인했고, 개발자 도구로 브라우저 상의 head를 보았을 때는 문제가 없었다.</p>\n<p>[상세페이지에서도 나오는 default 이미지와 description]\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 380px; '>\n      <a class='gatsby-resp-image-link' href='/static/34c21fc05becfa54fe513e6a72e6e1a6/2edd7/og.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 127.05882352941175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEu0lEQVR42o2U+1OUVRiA+Qdqph/KmklzphwrJAkUU7kojhmmJqLiBYbUTFNUZtKZSCcVjdBpzEgNRQHvWZoKiCw3lYss4rLgCntjryyXRZZlWS67UDydXU3tIrgzz77ve2a+5/vOOfO+PgU1Rp5GIjP8h/y7ei8lcjlldVWCasrv3RFUe/OyujtUiLpYrsLn38L/o0TRRtl9Hc3m9ZhN0SJGodMtR6+LxmRYitEYg8X4ERpt0shCiUzPiewbnL5eTE7+Nm7mrUJWuhFZ+WbqqrZSe3sz5QXrUdQkImsoeLbQs9WiWjO5UjUhn3zIrJULiZg7g0OrgzizJYybB2OpykigNDWG89tmIb10DJnW+XzC4IiZvD09gC/mj6N0fwTbw1+m9MBCqjPWkP11EMnRb1F0ZANyTetzCCvVBAQH4TfZj3D/19kX9z6pa0O5kRrL7bRlHFzxBomR73FhTxynf70yzBkKYaHczPUqDTNCAvH1fZPQaf4Ejn6BML+xnNm5FmlaPAXHdnDxQBKSIymcy8ocSWhCUq0lZmkE/uPHsnPBNPbMmUjUzCCWzJ5O2pfruJKZzuE920mKj+NYxqkRbllmpLjWhFKlpFpaiVl1n95WE13WFtraWmk2GQR6LGYjRp0aqUI7vDD/rkEIzdgd3bS3P6BLRPfgIC63m/7+fvpdLhFd9Ak8P01z59NCwz+QCG7dM1Glaqbb6cTZ3UWP0+GNzm4HXXYbvb1Oenq7RewRusEnQkmNOKsai5d8WbMQeqIFqbINudZKV88Azl433T0uevsGRHQL0QADf+DFNTjEn0NQbxJCz4O3amtQaXajETRqd4k8CbXIVZq9NGiS0TR+h1aXImIKau0+NCJv1CULvhV1imjDZNF625Ers/G5LmulUlFMkz4URf0C1Kq5KBoWoFR+jNUYTLNYt+jDaDEE0yrqFkOoiNNp0YfQJmKrWG83BdPbMs77Yh/PFsvqpBga1wpRAvXKLajU8ajVG7E3LcdhicZmihIsptODMRK7qLsEDvNiERfRoY/CaZlPnfL0k0spqtGJ8aP1UiRvFHUjhWLd03qL160hdusmln26jNRNc7icsoKSoxuoPL+Dm8c38kvSEm7nZnFHZX0ilNSYHyIzey8pX2YSrdfkbb2pc0KZEP4Bq+a9Q96OEPZGjKLsh0iqj6+mODmctM/8KM1MRGGwP99wmBw2jXEB77JoymtcTJzJ/uiJFH8fiTQ9lsMxY0iYPYZLySvJLq4YXlgohHlCOHVqIAFiOEya5Evw+JdYExFIwU8JVB1dxYXdS8jaFU/uj9+QcTx95OGQL3p53uwpjH7lRT4P8yVuwij8x77KyvBJnE1cT8G5k5xI3smhr+I5mXlq5IldKDom5+rvZKX/TNXls2glv3H3Rj5517IpzbuK9FYRpUV55Fw8S85wW/572yV1ZhzdTh50dOBw9nh7dmhoyPP3KH9Ue3rZ0vlsoWd0FQhK7jXR2eXAZrOJ/rXTaevA3mnHarXS0WHzrts6bQy4XaiHE14Tl3G1vF6cpZ5eMU1c/X309/WLB90i78ftejhhHn/xSF+YK1WRXdEgLkWHvLGNOr31MbW6Ni9PrykM7VTUW/gLO+czwaNlG1IAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='og' title='' src='/static/34c21fc05becfa54fe513e6a72e6e1a6/2edd7/og.png' srcset='/static/34c21fc05becfa54fe513e6a72e6e1a6/e7570/og.png 170w,\n/static/34c21fc05becfa54fe513e6a72e6e1a6/f46e7/og.png 340w,\n/static/34c21fc05becfa54fe513e6a72e6e1a6/2edd7/og.png 380w' sizes='(max-width: 380px) 100vw, 380px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>og</figcaption>\n  </figure>\n문제를 해결하기 위해 고민을 하다가 상세 페이지에 전달되는 <code class=\"language-text\">job</code> 을 <code class=\"language-text\">&lt;u>CSR에서 불러와&lt;/u></code> 내용이 전달이 되지 않은 것 같다고 생각이 들었다. 그래서 서버 사이드로 내용을 prefetching을 해서 전달해주면 바로 header에 전달해 줄 수 있겠다고 예상했다.</p>\n<h3>SSR을 이용한 data fetching</h3>\n<p>data fetching은 처음 프로젝트를 기획부터 고민했던 부분이었다. 서버에서 데이터를 받아오기 때문에 별도의 loading없이 보여줄 수 있지만 당장 필요한 부분일까 고민이 되어서 미뤄뒀었다. 이번 기회에 next의 data fetching에 대해 공부하고 적용할 수 있었다.</p>\n<p>Next에서 data fetching은 SSG, SSR, CSR 다 지원한다. 이중에서 기존에 사용하고 있던 방식은 CSR이었고, 프로젝트에 필요한 방식은 SSR이라고 생각되었다. SSG를 next에서 먼저 추천해 주기도 하고 이미 빌드에서 만든 페이지를 응답하기 때문에 더 빠른 페이지 로딩 속도를 가지지만, 모으잡 프로젝트 특성 상 계속해서 채용공고 데이터를 추가, 삭제, 수정하기 때문에 <strong>SSR</strong>을 적용하는 게 알맞은 선택이라 생각했다.</p>\n<p>SSR을 적용하기 위해서는 react-query에서 SSR을 적용하는 방법을 공부해야 했다. React query는 두 가지 방법을 지원한다.</p>\n<ul>\n<li>initialState</li>\n<li>hydration</li>\n</ul>\n<p><strong>initialState</strong>는 SSR에서 getServersideprops로 데이터를 불러온 후에 직접 props로 전달하기 때문에 보다 직관적이고 추가적인 코드 량이 적었다. 하지만 <code class=\"language-text\">useQuery</code>자체가 깊은 자식이 이용 시 inital data 자체를 전달해야 하기 때문에 prop-driliing이 생기고, 여러 곳에서 <code class=\"language-text\">useQuery</code>를 사용해야 할 경우에도 다 전달해줘야 하는 단점이 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// react-query 공식홈페이지 예시</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getPosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> posts <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Posts</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    queryFn<span class=\"token operator\">:</span> getPosts<span class=\"token punctuation\">,</span>\n    initialData<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그래서 확장성과 유지보수를 고려했을 때 내가 선택한 방식은 두 번째 <strong>Hydration</strong> 방식이었다. prefetch한 데이터를 전달해줘 마크 업을 한 후에 hydrate(수분공급, 이벤트를 연결하는 과정)하는 것을 의미한다. 이것을 하기 위해서는 앞선 initialData보다는 조금 더 복잡한 별도의 세팅이 필요하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// react-query 공식홈페이지 예시</span>\n\n<span class=\"token comment\">// _app.jsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  Hydrate<span class=\"token punctuation\">,</span>\n  QueryClient<span class=\"token punctuation\">,</span>\n  QueryClientProvider<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>queryClient<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Hydrate</span></span> <span class=\"token attr-name\">state</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>pageProps<span class=\"token punctuation\">.</span>dehydratedState<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Component</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Hydrate</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// pages/posts.jsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dehydrate<span class=\"token punctuation\">,</span> QueryClient<span class=\"token punctuation\">,</span> useQuery <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> getPosts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      dehydratedState<span class=\"token operator\">:</span> <span class=\"token function\">dehydrate</span><span class=\"token punctuation\">(</span>queryClient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 예시를 참고해서 <code class=\"language-text\">_app.tsx</code> 적용했을 때 아래 코드와 같이 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// _app.tsx</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>queryClient<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        defaultOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          queries<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            staleTime<span class=\"token operator\">:</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DefaultSeo</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>defaultSEO<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        ...\n           </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Hydrate</span></span> <span class=\"token attr-name\">state</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>pageProps<span class=\"token punctuation\">.</span>dehydratedState<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n             </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Component</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n           </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Hydrate</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n         ...\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactQueryDevtools</span></span> <span class=\"token attr-name\">initialIsOpen</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp<span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">_app.tsx</code>는 추가하기만 하면 되었지만, 페이지에서 직접 datafetching을 적용하면서 문제가 생겼다. 우선은 데이터를 받아올 때 기존의 경우는 <code class=\"language-text\">jobList</code>컴포넌튼 내부에서 session을 전달받아 데이터를 불러오고 있었다. 페이지에서 data-fetching을 한다면 컴포넌트는 data-fetching에 대해서는 모르고 <strong>주입받은 데이터를 보여주기 만</strong> 하게 할 수 있지 않을까 생각되어 수정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 기존 Joblist 컴포넌트</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">JobList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> session <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> session<span class=\"token operator\">:</span> Session <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> pathname <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isUser <span class=\"token operator\">=</span> pathname <span class=\"token operator\">===</span> <span class=\"token string\">'/user'</span> <span class=\"token operator\">||</span> pathname <span class=\"token operator\">===</span> <span class=\"token string\">'/user/[id]'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> session<span class=\"token operator\">?.</span>user<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> getFilteredJobs <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useJobs</span><span class=\"token punctuation\">(</span>isUser <span class=\"token operator\">?</span> user <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isLoading<span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> jobs <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> getFilteredJobs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> vacantJobs <span class=\"token operator\">=</span> jobs<span class=\"token operator\">?.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isLoading<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GuideBox</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">채용공고를 불러오는 중입니다...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">GuideBox</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>vacantJobs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GuideBox</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">채용공고가 비어있습니다😉</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">GuideBox</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Wrapper</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>jobs <span class=\"token operator\">&amp;&amp;</span> jobs<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">JobItem</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>job<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">job</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>job<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Wrapper</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 수정한 Joblist 컴포넌트</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">JobList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> jobs <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> JobListProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> vacantJobs <span class=\"token operator\">=</span> jobs<span class=\"token operator\">?.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>jobs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>vacantJobs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GuideBox</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">채용공고가 비어있습니다😉</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">GuideBox</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Wrapper</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>vacantJobs <span class=\"token operator\">&amp;&amp;</span> jobs<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">JobItem</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>job<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">job</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>job<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Wrapper</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>최대한 컴포넌트는 로직에 대해서 모르게 하고 페이지에서 필요한 데이터를 넘겨주는 방식으로 수정해, 훨씬 의존성을 낮출 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// pages/index.tsx</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> getJobs <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useJobs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> getJobs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MainLayout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">JobSection</span></span> <span class=\"token attr-name\">jobs</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">MainLayout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Home<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getServerSideProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> dbService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DBServiceImpl</span><span class=\"token punctuation\">(</span>firebaseApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">prefetchQuery</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Jobs<span class=\"token punctuation\">,</span> AxiosError<span class=\"token punctuation\">,</span> Jobs<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span><span class=\"token constant\">JOBS_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'all'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> dbService<span class=\"token punctuation\">.</span><span class=\"token function\">getJobs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> dehydratedState<span class=\"token operator\">:</span> <span class=\"token function\">dehydrate</span><span class=\"token punctuation\">(</span>queryClient<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// pages/jobs/[id].tsx</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> getFilteredJobs<span class=\"token punctuation\">,</span> getJobById <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useJobs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> job <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> getJobById<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> allJobs <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> getFilteredJobs<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      ...\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MainLayout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>job <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">NotFound</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        </span><span class=\"token punctuation\">{</span>job <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DetailJob</span></span> <span class=\"token attr-name\">job</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>job<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">JobSection</span></span> <span class=\"token attr-name\">jobs</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>allJobs<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">MainLayout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Index<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getServerSideProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> NextPageContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span>id<span class=\"token operator\">?.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> dbService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DBServiceImpl</span><span class=\"token punctuation\">(</span>firebaseApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      redirect<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        destination<span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">await</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">prefetchQuery</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Jobs<span class=\"token punctuation\">,</span> AxiosError<span class=\"token punctuation\">,</span> Jobs<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span><span class=\"token constant\">JOBS_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'all'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> dbService<span class=\"token punctuation\">.</span><span class=\"token function\">getJobs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> dehydratedState<span class=\"token operator\">:</span> <span class=\"token function\">dehydrate</span><span class=\"token punctuation\">(</span>queryClient<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 서버 사이드 렌더링 data-fetching으로 수정하고 다시 확인했을 때 정상적으로 카카오 톡, 페이스북, slack 모두 잘 나오는 것을 볼 수 있었다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/90808904e9bdfb937e66f7ad6a402d30/2d788/sns.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 52.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcSAAAXEgFnn9JSAAAC0UlEQVR42m1TS08TYRSdhRuJ/gGXLl36A2ShK93rwp3xkShUVCIgCdFEIEBBCI8KQcIbW3mJQItgeTThUdvShtICbWkZBlqo7RRm6GMe33GmqCHEk5x8i3u/c+69uZeizgDABfU9OUmVi6IIhmEkBSCEKCEifV3NYOhnIl/NiUajl222sRzs2XKU4D9SdneL3rv5TB+i3+h9dJkhuF/U63CZHKv2VbAsS1TBTDqjyMlQkbCs7wfaTTtbhwf0qstDuzcD9BGfohXTLCm7fwleegz9g09h6b4B3/e72A65+HAkRk54DonEEQQhA1kRFiRJlrlkKv2Lwy7LI8qlkFaMkoIMmWT9QJlsu9LMWkJ68FgjvbxzXep7r5GXFizH3V0dRFv7AdraOnzq6kFnzwAWzCbCxqJJ9WMoGCSBQIDwHJedx19SJnsYRkcMG9ssDg+TiB0DPn+Ir68pJw0tbej9rId5xoyR4Ql0VxXIIh9PqYKbmxvY8HqhiCJycABREE4rXF4bhNOrRXC3FfSeDnuRjwjs2HmGiZIYH8NW0APa74LL6UJbVYks8GxW0NjXCJ1OB8PQKAZ6OjHXr4UsCqDmnWZY1w2wTBVj2lQKy2QB5k2dvNVqI/GDLfg8C/C7HbBOjuNLU4Wc5lRBgh+GJjidVng9Nhj1vRiufw1FEZTRHhaVlkXz1Iy4sb4lWgYHxemRgeOp8SEiplKwL1vR165DT0keFjtqZCHJZyuc66/Ct2E9Wpoa0VyUh9n2SkhiRmk5kMCiL479OKcYZLKT3Q36+FeP7pG85y+Qm3sTV65ew/3btzDb/A7Jo0RETXHPjTDaqkqmsPQt01hdwaxMGhhRFBhq2hHSGFf8Goc/rAlG2AJPhH/IRiMTo71tKCwuk+saWtDQ3Irqaq3knjMilYjn/zmCSwovnif1v0sRZblcbYvjOEm9GBXK0kqnm4YnZ3PP4zeYi6IbSRCREgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='sns' title='' src='/static/90808904e9bdfb937e66f7ad6a402d30/ca1dc/sns.png' srcset='/static/90808904e9bdfb937e66f7ad6a402d30/e7570/sns.png 170w,\n/static/90808904e9bdfb937e66f7ad6a402d30/f46e7/sns.png 340w,\n/static/90808904e9bdfb937e66f7ad6a402d30/ca1dc/sns.png 680w,\n/static/90808904e9bdfb937e66f7ad6a402d30/02d09/sns.png 1020w,\n/static/90808904e9bdfb937e66f7ad6a402d30/9d567/sns.png 1360w,\n/static/90808904e9bdfb937e66f7ad6a402d30/2d788/sns.png 1382w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>sns</figcaption>\n  </figure></p>\n<p>google 자체에도 등록하기 위해 <a href=\"https://search.google.com/search-console/about\">Google Search Console</a> 에 사이트를 등록하고 확인했을 때 아직은 실제로 검색이 되지 않는다. 시간이 걸리는 부분이라 계속해서 확인을 해볼 예정이다.</p>\n<h2>🙄 SSR로 진짜 성능이 개선되었을까?</h2>\n<p>SSR을 이용해 data-fetching으로 수정을 하고 나서 코드 적으로 더 가독성이 높아지고, 로딩 창을 보여주지 않고 한번에 화면이 보여 더 UX가 체감 상 좋아졌다. 하지만 정말 좋아졌는지 확인하기 위해서 google의 <a href=\"https://pagespeed.web.dev/\">page speed insights</a>을 이용해 측정해 보기로 했다. 기존과 비교하기 위해서 EC2로 배포되어있는 CSR을 이용하는 배포 버전과 vercel로 SSR이 적용되어있는 버전의 성능을 측정했다.</p>\n<p>측정을 하고 분석하는데 필요한 6가지 요소에 대해서 정리하고 요소들을 분석해보았다.</p>\n<h3>FCP</h3>\n<p>FCP는 First Contentful Paint로 페이지가 로드되고 페이지 콘텐츠 일부가 화면에 렌더링 될 때 까지의 시간을 측정한다.</p>\n<h3>TTI</h3>\n<p>TTI는 사용자와 상호작용하기 위해 준비된 시점으로, 이벤트 헨들러가 작동할 수 있는 시점을 의미한다.</p>\n<h3>Speed Index</h3>\n<p>Speed index는 컨텐츠가 시각적으로 표시되는 진행속도를 의미한다.</p>\n<h3>LCP</h3>\n<p>LCP는 Largest Contentful Paint로 로딩 성능을 측정하는 지표로 처음 로드를 시작하고 ViewPort 내에서 가장 큰 이미지나 텍스트 블럭의 렌더링 시간을 측정한다.</p>\n<h3>FID와 TBT</h3>\n<p>FID는 First Input Delay로 상호작용을 측정하는 지표로 사용자의 처음 상호작용부터 이벤트 핸들러가 처리를 시작하기까지 시간을 측정한다.</p>\n<p>검사에 사용한 page speed insights은 FID 대신에 <strong>TBT</strong>(Time Blocking Time)를 측정했다. TBT는 FCP부터 TTI 까지의 시간을 측정해 사용자 입력에 페이지가 응답하지 못하게 차단된 시간을 의미한다.</p>\n<h3>CLS</h3>\n<p>CLS는 Cumulative Layout Shift로 사용자가 예상하지 못한 레이아웃 이동을 경험하는 것에 대한 지표다.</p>\n<p>[왼쪽은 CSR로 측정한 성능, 오른쪽은 SSR로 측정한 성능]\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/6c27fb7e156eec1d74facd860e95f36f/ef635/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABcSAAAXEgFnn9JSAAABDUlEQVR42kWQ20rEQAyG+/6vJN4JUmGL7F6IsoJ4IdIt2512Dp1D8ps5dA2ESZM/X5J2EIucMMUFzAQfIq46IKaEGCPlOhEN8vQ5Hr2iQAlJ6tc1wLkNmzEwNuQyOjCg44aT+pZGLkkScHGx/C3Nd+BJfZFL0lyl+Ph8x8PzE16HN0kxOpJJYfNYtYX1QbaswLJhSv9AogJcVkNa9KkN/zkfMRwPcFaXrTvnNw7eFwzqXPYxsJzLYqmdfBBd3+KGAkKKiMGD6yEVOLsbjLdNUqUXPUFvuvS3wnDR155rndqL2SpMy4TdZAHZ0KjR6HXM/3t3ZSVnTY5/xTP5cXbqhTKf7kOwegOlbwW0A/8Aq9TSmmp2F+gAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='성능비교' title='' src='/static/6c27fb7e156eec1d74facd860e95f36f/ca1dc/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png' srcset='/static/6c27fb7e156eec1d74facd860e95f36f/e7570/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png 170w,\n/static/6c27fb7e156eec1d74facd860e95f36f/f46e7/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png 340w,\n/static/6c27fb7e156eec1d74facd860e95f36f/ca1dc/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png 680w,\n/static/6c27fb7e156eec1d74facd860e95f36f/02d09/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png 1020w,\n/static/6c27fb7e156eec1d74facd860e95f36f/9d567/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png 1360w,\n/static/6c27fb7e156eec1d74facd860e95f36f/ef635/%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90.png 1391w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>성능비교</figcaption>\n  </figure></p>\n<p>각 지표들 중에서 크게 차이가 난 부분은 <code class=\"language-text\">TTI</code>와 <code class=\"language-text\">LCP</code>로 TTI는 이전보다 증가했고 LCP는 83% 감소한 결과를 보여주었다. 이전에는 가장 큰 컨텐츠인 이미지가 로딩 이후에 보여주었지만, 서버에서 데이터를 받아서 먼저 렌더링을 한 후에 이벤트를 붙여 주는 hydration 과정이 일어나기 때문에 TTI는 증가하고 LCP는 감소한 결과를 보여주었다.</p>\n<p>결과적으로는 전보다 개선이 된 결과를 얻을 수 있었다. 여기서 더 개선을 한다면 이미지 자체를 react-query를 통해 어떻게 캐싱을 해 렌더링 횟수를 관리할 지가 된다고 생각한다. 단순히 느낌적으로 좋아졌다고 생각하는 데서 그치지 않고 직접 측정함으로써 객관적인 데이터를 얻을 수 있는 좋은 경험이 되었다.</p>\n<p>[참조]</p>\n<ul>\n<li>SEO (검색엔진최적화) 완벽 가이드 총정리 (2022년): <a href=\"https://www.ascentkorea.com/seo-complete-guide-2022/\">https://www.ascentkorea.com/seo-complete-guide-2022/</a></li>\n<li>webvitals: <a href=\"https://web.dev/vitals/\">https://web.dev/vitals/</a></li>\n</ul>","frontmatter":{"title":"모으잡-서버사이드 랜더링을 이용한 성능 개선","date":"December 25, 2022","tags":["사이드프로젝트","모으잡"],"series":"모으잡"},"fields":{"slug":"/2022-12-25-모으잡-서버사이드-랜더링을-이용한-성능개선/","readingTime":{"minutes":18.825}}},"seriesList":{"edges":[{"node":{"id":"119332ec-e524-5a0a-8773-e8ef24adbf82","fields":{"slug":"/2022-09-22-채용공고-정리사이트-기획/"},"frontmatter":{"title":"채용공고 정리 서비스 기획"}}},{"node":{"id":"8ca4b7be-9b74-5889-a1b7-4e4e01fa7a9b","fields":{"slug":"/2022-10-15-모으잡-기획-구체화/"},"frontmatter":{"title":"모으잡-기획 구체화"}}},{"node":{"id":"8ea4e93c-32f8-510d-93e8-119bce76ffdd","fields":{"slug":"/2022-10-16-파이썬을-이용한-크롤러제작/"},"frontmatter":{"title":"모으잡-파이썬을 이용한 웹크롤러 제작"}}},{"node":{"id":"cfdd02da-1612-5a94-b864-05cc7da35ec9","fields":{"slug":"/2022-10-17-flask-서버만들기/"},"frontmatter":{"title":"모으잡-flask이용해 SSR서버만들기"}}},{"node":{"id":"144088bc-f664-55f4-a82a-014413a07549","fields":{"slug":"/2022-10-20-모으잡-cors-에러핸들링/"},"frontmatter":{"title":"모으잡-express cors 에러, 에러핸들링"}}},{"node":{"id":"bf96854b-679b-5f60-a254-c1d71d4c6b77","fields":{"slug":"/2022-10-22-모으잡-express-서버-제작-시작-cheerio/"},"frontmatter":{"title":"모으잡-express 서버 제작 시작과 cheerio"}}},{"node":{"id":"94a1d33a-6956-5a2f-9ee9-188b03f080a6","fields":{"slug":"/2022-10-23-모으잡-puppeteer-크롤러제작-프론트페이지-구상/"},"frontmatter":{"title":"모으잡-puppeteer을 이용한 크롤러제작, 프론트페이지 구상"}}},{"node":{"id":"e0ed8043-551e-5bd1-99bc-2300ea066763","fields":{"slug":"/2022-10-24-모으잡-프론트페이지-UI제작/"},"frontmatter":{"title":"모으잡-프론트페이지 UI제작"}}},{"node":{"id":"b8ed216b-41ca-5e03-8bf6-6d33b40fb63e","fields":{"slug":"/2022-10-25-모으잡-UI-수정-크롤링-데이터-연결/"},"frontmatter":{"title":"모으잡-프론트페이지 UI수정, 크롤링한 데이터 받아오기"}}},{"node":{"id":"00d9fb6e-4fd8-5549-94ef-61f365359149","fields":{"slug":"/2022-11-23-모으잡-Next-migration/"},"frontmatter":{"title":"모으잡-Next js로 migration, 디자인 수정"}}},{"node":{"id":"898c5886-c432-574a-a308-3528f3a39982","fields":{"slug":"/2022-11-25-모으잡-회원가입로그인-로직/"},"frontmatter":{"title":"모으잡-firebase를 이용한 회원가입 로직 구현"}}},{"node":{"id":"c4321aba-89b2-5f15-bcbb-570673b7e7f2","fields":{"slug":"/2022-11-29-모으잡 DB연결과-크롤링-기능-연결/"},"frontmatter":{"title":"모으잡-DB연결과 크롤링 기능 연결"}}},{"node":{"id":"4f7bed59-f9dc-5f76-bfdf-760ad169011d","fields":{"slug":"/2022-11-30-모으잡-배포/"},"frontmatter":{"title":"모으잡-vercel부터 aws까지 배포과정"}}},{"node":{"id":"b54b712d-8390-592a-bbc1-97d511193b5b","fields":{"slug":"/2022-12-17-모으잡-인증인가/"},"frontmatter":{"title":"모으잡-SSR을 이용한 인증,인가 도입"}}},{"node":{"id":"aed894f3-fcd8-5b75-98e9-1964f42739ef","fields":{"slug":"/2022-12-23-모으잡-기획-디자인 수정/"},"frontmatter":{"title":"모으잡-기획, 디자인 수정"}}},{"node":{"id":"4d86f4ac-998a-59a5-a4e2-a474b8dbc7f7","fields":{"slug":"/2022-12-25-모으잡-서버사이드-랜더링을-이용한-성능개선/"},"frontmatter":{"title":"모으잡-서버사이드 랜더링을 이용한 성능 개선"}}}]},"previous":{"fields":{"slug":"/2022-12-23-class/"},"frontmatter":{"title":"클래스"}},"next":{"fields":{"slug":"/2023-01-02-타입스크립트란/"},"frontmatter":{"title":"TS study: 타입스크립트란"}}},"pageContext":{"id":"4d86f4ac-998a-59a5-a4e2-a474b8dbc7f7","series":"모으잡","previousPostId":"a94c02b8-45b0-5fac-b129-cf99c64a8f24","nextPostId":"450c65d9-1adb-5355-86a6-38e29edf10f5"}},"staticQueryHashes":[],"slicesMap":{}}